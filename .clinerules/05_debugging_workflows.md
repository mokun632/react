# デバッグワークフローに関するルール

このドキュメントは、React のコードベースをデバッグする際の AI エージェント活用方法や注意点をまとめたガイドラインを定めます。

## 1. デバッグの基本アプローチ

*   **問題の特定と再現**
    *   エラーメッセージや警告の正確な把握
    *   最小限の再現ケースの作成
    *   関連するコンポーネントやモジュールの特定

*   **コード追跡と分析**
    *   関連するコードパスの特定と追跡
    *   エラー発生箇所までのコールスタックの解析
    *   実行フローの可視化

*   **仮説と検証**
    *   可能性のある原因の列挙
    *   各仮説の検証方法の提案
    *   修正アプローチの評価

## 2. AI エージェントの活用パターン

*   **エラーメッセージの解析**
    *   React 固有のエラーパターンの認識と解説
    *   原因となる可能性のあるコードパターンの特定
    *   ドキュメントやソースコードへの参照

*   **デバッグ情報の視覚化**
    *   コンポーネントツリーや Fiber ツリーの視覚的表現
    *   レンダリングフローのシーケンス図作成
    *   状態更新とその伝播経路の図示

*   **実行環境の構築**
    *   デバッグ用の実行環境作成
    *   特定の状態を再現するためのコード提案
    *   `fixtures/` ディレクトリ内の類似事例の検索と参照

## 3. デバッグツールの活用

*   **React DevTools**
    *   DevTools の使用方法と出力の解釈
    *   コンポーネント階層とプロパティの検査
    *   Profiler での再レンダリング原因特定

*   **ブラウザデバッグツール**
    *   ブレークポイントの適切な設置箇所の提案
    *   React 固有の条件付きブレークポイントの設定
    *   メモリリークや無限ループの検出

*   **コンソールやログ**
    *   効果的なログ出力位置の提案
    *   `console.log` vs `debugger` の使い分け
    *   React の内部状態をログに出力する方法

## 4. 特定のエラーパターンへの対応

*   **レンダリングエラー**
    *   無限ループレンダリングの検出と修正
    *   Suspense と ErrorBoundary 関連の問題
    *   キー（key）やメモ化に関する問題

*   **状態管理の問題**
    *   ステート更新の非同期性によるバグ
    *   コンテキストや props の伝播問題
    *   フック（hooks）の依存配列関連のエラー

*   **パフォーマンス問題**
    *   不要な再レンダリングの特定
    *   メモリリークの検出手法
    *   バンドルサイズや初期化時間の最適化

## 5. デバッグ情報の収集

*   **エラー再現の手順**
    *   正確な再現手順の記録
    *   環境情報（React バージョン、ブラウザなど）の収集
    *   関連するコンポーネントの状態とプロパティ

*   **プロファイリングデータ**
    *   React Profiler での計測方法
    *   Chrome Performance タブでの記録方法
    *   計測データの解釈と問題箇所の特定

*   **コード関連情報**
    *   問題のあるコードブロックの特定
    *   関連する Fiber ノードの状態
    *   コンポーネントライフサイクルの追跡

## 6. Cline への指示

*   デバッグプロセスのサポート時:
    *   エラーメッセージの詳細な解析と原因の説明
    *   エラーが発生した文脈と条件の特定
    *   コードベースの関連部分を特定し、追跡するための方法の提案

*   仮説検証の補助:
    *   各仮説を検証するためのコードスニペットや変更の提案
    *   期待される動作と実際の動作の違いの説明
    *   関連するテストケースやフィクスチャの参照

*   修正案の提示:
    *   問題の根本原因に基づく複数の解決策の提案
    *   各解決策のメリット・デメリットの説明
    *   適切なパターンやベストプラクティスに基づく修正の提案

## 7. 注意点

*   React の内部実装は頻繁に変更されるため、バージョンによって異なる場合がある
*   開発モードと本番モードでは動作が異なることがあるため、両方でテストすることが重要
*   デバッグの過程で追加したコードが新たな問題を引き起こす可能性も考慮する
*   フロー制御（条件分岐、ループなど）の微妙な違いが予期せぬ挙動の原因となることがある
