# テストコードに関するルール

このドキュメントは、React のテストコード (`fixtures/` ディレクトリや各パッケージ内のテストなど) を理解・分析・実行する際のガイドラインを定めます。

## 1. テストコード概要

React のテストコードは主に以下のカテゴリに分類されます：

* **ユニットテスト**: 各パッケージ内の `__tests__` ディレクトリに配置された、個別の機能をテストするコード
* **インテグレーションテスト**: 複数のコンポーネントやモジュールの連携をテストするコード
* **フィクスチャ**: `fixtures/` ディレクトリに配置された、特定のユースケースやパターンを検証するためのミニアプリケーション
* **リグレッションテスト**: 以前に発生した問題が再発しないことを確認するためのテスト

## 2. 分析ポイント

*   **テスト構造**
    *   テストケースの構成方法と実行フロー
    *   モック、スタブ、スパイの使用パターン
    *   非同期テストの実装手法

*   **フィクスチャアプリケーション**
    *   `fixtures/` ディレクトリ内のアプリケーション構造
    *   特定の機能や問題を検証するためのコードパターン
    *   実際のユースケースとの関連性

*   **テストユーティリティ**
    *   `packages/internal-test-utils/` などのテスト用ヘルパー
    *   `ReactTestRenderer` や `react-dom/test-utils` の使用方法
    *   Jest と連携するためのカスタム設定

## 3. テスト実行戦略

*   **ユニットテスト実行**
    *   特定のパッケージやファイルのテストを単独で実行する方法
    *   テスト結果の解釈と問題のデバッグ
    *   パフォーマンステストやスナップショットテストの実行

*   **フィクスチャアプリケーション実行**
    *   フィクスチャアプリケーションのビルドと実行
    *   特定のシナリオを再現するための設定変更
    *   テスト結果の確認と期待される動作との照合

## 4. Cline への指示

*   特定のテストケースの理解を助ける際:
    *   テストの目的と対象コードを明確に説明
    *   テストの設定、実行、検証の各ステップを解説
    *   特に重要なアサーションや条件チェックに焦点を当てる

*   フィクスチャアプリケーションの分析:
    *   アプリケーションの主な機能と検証対象の機能を特定
    *   実装パターンと React の推奨プラクティスの関連を説明
    *   特定の問題やエッジケースを再現する方法を解説

*   テスト実行のサポート:
    *   テスト実行のための適切なコマンドを提案
    *   テスト失敗時のエラーメッセージの解釈を支援
    *   テスト結果を元にした問題の特定と解決策の提案

## 5. フィクスチャ分析例

*   **DOM フィクスチャ** (`fixtures/dom/`):
    *   ブラウザ固有の問題を再現するための DOM 操作テスト
    *   イベントハンドリングや CSS の問題を検証するケース
    *   アクセシビリティ機能のテスト

*   **Concurrent モードフィクスチャ** (`fixtures/concurrent/`):
    *   非同期レンダリングと Suspense パターンのテスト
    *   時間スライシングとプライオリティ設定の検証
    *   Transition API の動作確認

*   **DevTools フィクスチャ** (`fixtures/devtools/`):
    *   React DevTools との統合テスト
    *   コンポーネントのプロファイリングと最適化
    *   特定の問題を再現するためのシナリオ

## 6. 注意点

*   テストの中には、特定の環境（Node.js のバージョンや設定）でのみ動作するものがある
*   一部のフィクスチャは実験的な機能をテストするためのもので、安定版 React とは動作が異なる場合がある
*   テスト実行時にはパフォーマンス面での考慮が必要（特に大規模なテストスイートの場合）
*   フィクスチャの中には、特定のブラウザや環境でのみ問題が再現するものも存在する
